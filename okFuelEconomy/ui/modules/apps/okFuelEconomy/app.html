<div class="bngApp"
     ng-init="useCustomStyles=true"
     ng-attr-style="{{ 'width:100%; height:100%; overflow:auto; position:relative;' + (useCustomStyles ? ' padding:4px; border-radius:10px; background-color:rgba(10,15,20,0.75); background-image:linear-gradient(rgba(0,200,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,200,255,0.05) 1px, transparent 1px); background-size:16px 16px,16px 16px; color:#aeeaff; font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif; letter-spacing:0.3px; box-shadow: inset 0 0 10px rgba(0,200,255,0.25);' : '') }}"
     layout="column">

  <strong ng-if="visible.heading"
          ng-attr-style="{{ useCustomStyles ? 'display:block; margin:2px 0 4px; padding-left: 2px; font-size:1em; font-weight:600; color:#3fd6ff; text-shadow:0 0 5px rgba(0,255,255,0.6);' : '' }}">
    Fuel Economy: {{ vehicleNameStr }}
  </strong>

  <table ng-attr-style="{{ useCustomStyles ? 'width:100%; border-collapse:collapse; font-size:0.85em;' : '' }}">
    <tr ng-if="visible.distanceMeasured || visible.distanceEcu">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; width:38%; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Traveled distance:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <span ng-if="visible.distanceMeasured">Measured: {{ data1 }}</span>
        <span ng-if="visible.distanceMeasured && visible.distanceEcu"> | </span>
        <span ng-if="visible.distanceEcu">From ECU: {{ data6 }}</span>
      </td>
    </tr>

    <tr ng-if="visible.fuelUsed || visible.fuelLeft || visible.fuelCap">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; width:38%; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Fuel:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <span ng-if="visible.fuelUsed">Used: {{ fuelUsed }}</span>
        <span ng-if="visible.fuelUsed && (visible.fuelLeft || visible.fuelCap)"> | </span>
        <span ng-if="visible.fuelLeft">Left: {{ fuelLeft }}</span>
        <span ng-if="visible.fuelLeft && visible.fuelCap"> | </span>
        <span ng-if="visible.fuelCap">Capacity: {{ fuelCap }}</span>
      </td>
    </tr>

    <tr ng-if="visible.avgL100km || visible.avgKmL">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Average consumption:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <span ng-if="visible.avgL100km">{{ avgL100km }}</span>
        <span ng-if="visible.avgL100km && visible.avgKmL"> | </span>
        <span ng-if="visible.avgKmL">{{ avgKmL }}</span>
      </td>
    </tr>

    <tr ng-if="visible.avgGraph">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Average history:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none" ng-attr-style="{{ 'width:100%; height:40px;' + (useCustomStyles ? ' background:rgba(0,200,255,0.05);' : '') }}">
          <polyline ng-attr-points="{{ avgHistory }}" ng-attr-style="{{ 'fill:none;stroke:' + (useCustomStyles ? '#5fdcff' : 'currentColor') + ';stroke-width:1;' }}"></polyline>
        </svg>
      </td>
    </tr>

    <tr ng-if="visible.instantLph || visible.instantL100km || visible.instantKmL">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Instant consumption:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <span ng-if="visible.instantLph">{{ instantLph }}</span>
        <span ng-if="visible.instantLph && (visible.instantL100km || visible.instantKmL)"> | </span>
        <span ng-if="visible.instantL100km">{{ instantL100km }}</span>
        <span ng-if="visible.instantL100km && visible.instantKmL"> | </span>
        <span ng-if="visible.instantKmL">{{ instantKmL }}</span>
      </td>
    </tr>

      <tr ng-if="visible.instantGraph">
        <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
          Instant {{ unitFlowUnit }} history:
        </td>
        <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
          <svg viewBox="0 0 100 40" preserveAspectRatio="none" ng-attr-style="{{ 'width:100%; height:40px;' + (useCustomStyles ? ' background:rgba(0,200,255,0.05);' : '') }}">
            <polyline ng-attr-points="{{ instantHistory }}" ng-attr-style="{{ 'fill:none;stroke:' + (useCustomStyles ? '#5fdcff' : 'currentColor') + ';stroke-width:1;' }}"></polyline>
          </svg>
        </td>
    </tr>

    <tr ng-if="visible.range">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Range:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        {{ data4 }}
      </td>
    </tr>

    <tr ng-if="visible.tripAvgL100km || visible.tripAvgKmL">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Trip average consumption:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <span ng-if="visible.tripAvgL100km">{{ tripAvgL100km }}</span>
        <span ng-if="visible.tripAvgL100km && visible.tripAvgKmL"> | </span>
        <span ng-if="visible.tripAvgKmL">{{ tripAvgKmL }}</span>
      </td>
    </tr>

    <tr ng-if="visible.tripGraph">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Trip average history:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none" ng-attr-style="{{ 'width:100%; height:40px;' + (useCustomStyles ? ' background:rgba(0,200,255,0.05);' : '') }}">
          <polyline ng-attr-points="{{ tripAvgHistory }}" ng-attr-style="{{ 'fill:none;stroke:' + (useCustomStyles ? '#5fdcff' : 'currentColor') + ';stroke-width:1;' }}"></polyline>
        </svg>
      </td>
    </tr>

    <tr ng-if="visible.tripDistance">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Trip distance:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        {{ data8 }}
      </td>
    </tr>

    <tr ng-if="visible.tripRange">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Trip range:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        {{ data9 }}
      </td>
    </tr>

    <tr ng-if="visible.tripReset">
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#69e0ff; font-weight:500; text-shadow:0 0 3px rgba(0,255,255,0.4); border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        Trip reset:
      </td>
      <td ng-attr-style="{{ useCustomStyles ? 'padding:3px 2px; color:#ccefff; border-bottom:1px solid rgba(0,180,255,0.10);' : '' }}">
        <span class="material-icons"
              ng-click="resetOverall($event)"
              ng-attr-style="{{ 'cursor:pointer; margin-left:6px;' + (useCustomStyles ? ' color:#5fdcff; text-shadow:0 0 5px rgba(0,255,255,0.6);' : '') }}">
          delete
        </span>
      </td>
    </tr>
  </table>

  <!-- Reset icon (global) -->
  <span class="material-icons"
        ng-click="reset($event)"
        ng-attr-style="{{ 'position:absolute; top:2px; right:4px; cursor:pointer; font-size:18px;' + (useCustomStyles ? ' color:#5fdcff; text-shadow:0 0 5px rgba(0,255,255,0.6);' : '') }}">
    autorenew
  </span>
  <!-- Style toggle icon -->
  <span class="material-icons"
        ng-click="useCustomStyles=!useCustomStyles"
        ng-attr-style="{{ 'position:absolute; top:24px; right:4px; cursor:pointer; font-size:18px;' + (useCustomStyles ? ' color:#5fdcff; text-shadow:0 0 5px rgba(0,255,255,0.6);' : '') }}">
    palette
  </span>
  <!-- Settings icon -->
  <span class="material-icons"
        ng-click="settingsOpen=!settingsOpen"
        ng-attr-style="{{ 'position:absolute; top:46px; right:4px; cursor:pointer; font-size:18px;' + (useCustomStyles ? ' color:#5fdcff; text-shadow:0 0 5px rgba(0,255,255,0.6);' : '') }}">
    settings
  </span>

  <!-- Settings dialog -->
  <div ng-if="settingsOpen"
       ng-attr-style="{{ 'position:absolute; top:68px; right:4px; z-index:10; background:rgba(0,0,0,0.85); padding:8px; border-radius:6px;' + (useCustomStyles ? ' color:#aeeaff; border:1px solid #5fdcff;' : ' color:#fff; border:1px solid #ccc; background:#333;') }}">
    <label><input type="checkbox" ng-model="visible.heading"> Heading</label><br>
    <label><input type="checkbox" ng-model="visible.distanceMeasured"> Distance measured</label><br>
    <label><input type="checkbox" ng-model="visible.distanceEcu"> Distance from ECU</label><br>
    <label><input type="checkbox" ng-model="visible.fuelUsed"> Fuel used</label><br>
    <label><input type="checkbox" ng-model="visible.fuelLeft"> Fuel left</label><br>
    <label><input type="checkbox" ng-model="visible.fuelCap"> Fuel capacity</label><br>
      <label><input type="checkbox" ng-model="visible.avgL100km"> Average {{ unitConsumptionUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.avgKmL"> Average {{ unitEfficiencyUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.avgGraph"> Average history</label><br>
      <label><input type="checkbox" ng-model="visible.instantLph"> Instant {{ unitFlowUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.instantL100km"> Instant {{ unitConsumptionUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.instantKmL"> Instant {{ unitEfficiencyUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.instantGraph"> Instant history</label><br>
      <label><input type="checkbox" ng-model="visible.range"> Range</label><br>
      <label><input type="checkbox" ng-model="visible.tripAvgL100km"> Trip average {{ unitConsumptionUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.tripAvgKmL"> Trip average {{ unitEfficiencyUnit }}</label><br>
      <label><input type="checkbox" ng-model="visible.tripGraph"> Trip average history</label><br>
      <label><input type="checkbox" ng-model="visible.tripDistance"> Trip distance</label><br>
      <label><input type="checkbox" ng-model="visible.tripRange"> Trip range</label><br>
      <label><input type="checkbox" ng-model="visible.tripReset"> Trip reset</label><br>
      <label>Units:
        <select ng-model="unitMode" ng-attr-style="{{ useCustomStyles ? 'background:rgba(0,200,255,0.15); color:#aeeaff; border:1px solid #5fdcff;' : '' }}">
          <option value="metric">Metric (L, km)</option>
          <option value="imperial">Imperial (gal, mi)</option>
          <option value="electric">Electric (kWh, km)</option>
        </select>
      </label><br>
      <button ng-click="saveSettings()"
              ng-attr-style="{{ 'margin-top:4px; font-size:0.8em; padding:2px 6px; cursor:pointer;' + (useCustomStyles ? ' color:#aeeaff; background:rgba(0,200,255,0.15); border:1px solid #5fdcff;' : '') }}">
        <span class="material-icons" ng-attr-style="{{ 'font-size:inherit; vertical-align:middle; margin-right:2px;' + (useCustomStyles ? '' : '') }}">save</span>Save
      </button>
  </div>
</div>
